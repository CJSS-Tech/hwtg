# Telegram æ•°æ®è‡ªåŠ¨è·å–å®ç°æŒ‡å—

## ğŸ“Š ç›®æ ‡æ•°æ®

æˆ‘ä»¬éœ€è¦è‡ªåŠ¨è·å–ä»¥ä¸‹æ•°æ®ï¼š
- **é¢‘é“**: `subscribers` (è®¢é˜…è€…æ•°é‡)
- **ç¾¤ç»„**: `memberCount` (æ€»æˆå‘˜æ•°)
- **ç¾¤ç»„**: `onlineCount` (åœ¨çº¿äººæ•°) âš ï¸ **API ä¸æ”¯æŒ**

---

## âš ï¸ åè®®å·ï¼ˆç§æœ‰é‚€è¯·é“¾æ¥ï¼‰çš„é™åˆ¶

**æ‚¨çš„èµ„æºå¤§å¤šä½¿ç”¨ç§æœ‰é‚€è¯·é“¾æ¥ `t.me/+xxxxx`ï¼Œè¿™å¸¦æ¥äº†è‡ªåŠ¨åŒ–çš„æŒ‘æˆ˜ï¼š**

1. âŒ **Bot æ— æ³•è‡ªåŠ¨åŠ å…¥**
   - ç§æœ‰é“¾æ¥éœ€è¦ç”¨æˆ·ç‚¹å‡»æˆ–ç®¡ç†å‘˜é‚€è¯·
   - Bot ä¸èƒ½é€šè¿‡ API è‡ªåŠ¨è®¿é—®è¿™äº›é“¾æ¥

2. âŒ **æ‰‹åŠ¨æˆæœ¬é«˜**
   - 65+ ä¸ªç¾¤ç»„/é¢‘é“éœ€è¦é€ä¸ªé‚€è¯· Bot
   - éœ€è¦æ‰€æœ‰ç¾¤ä¸»/ç®¡ç†å‘˜é…åˆ
   - Bot å¯èƒ½éšæ—¶è¢«è¸¢å‡º

3. âŒ **æ•°æ®è®¿é—®å—é™**
   - å³ä½¿ Bot åŠ å…¥ï¼Œä¹Ÿå¯èƒ½æ— è¯»å–æˆå‘˜æƒé™
   - ç§æœ‰ç¾¤ç»„é€šå¸¸æœ‰æ›´ä¸¥æ ¼çš„éšç§ä¿æŠ¤

---

## ğŸ”§ å®é™…å¯è¡Œçš„æŠ€æœ¯æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: Telegram Desktop è‡ªåŠ¨åŒ– + Selenium/Playwright (æœ€å®ç”¨)

**åŸç†**: æ¨¡æ‹ŸçœŸå®ç”¨æˆ·åœ¨ Telegram Web ä¸ŠæŸ¥çœ‹ç¾¤ç»„ä¿¡æ¯

#### âœ… ä¼˜ç‚¹
- âœ… å¯ä»¥è®¿é—®ç§æœ‰é‚€è¯·é“¾æ¥ï¼ˆç”¨ä½ çš„ä¸ªäººè´¦å·ï¼‰
- âœ… æ— éœ€ Bot åŠ å…¥ç¾¤ç»„
- âœ… è·å–å…¬å¼€æ˜¾ç¤ºçš„æˆå‘˜æ•°
- âœ… è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜

#### âŒ ç¼ºç‚¹
- âŒ éœ€è¦ç™»å½•ä½ çš„ä¸ªäºº Telegram è´¦å·
- âŒ ä¾èµ– Telegram Web ç•Œé¢ï¼ˆå¯èƒ½å˜åŒ–ï¼‰
- âŒ ä»ç„¶**æ— æ³•è·å–åœ¨çº¿äººæ•°**ï¼ˆWeb ç•Œé¢ä¸æ˜¾ç¤ºï¼‰
- âŒ é€Ÿåº¦è¾ƒæ…¢ï¼ˆéœ€è¦åŠ è½½é¡µé¢ï¼‰

---

### æ–¹æ¡ˆ B: GitHub Actions + Telegram Bot API (ç†è®ºæ–¹æ¡ˆ)

### æ–¹æ¡ˆ B: GitHub Actions + Telegram Bot API (ç†è®ºæ–¹æ¡ˆ)

#### âš ï¸ å‰ææ¡ä»¶ï¼ˆéš¾ä»¥æ»¡è¶³ï¼‰
- Bot å¿…é¡»è¢«é‚€è¯·åŠ å…¥æ‰€æœ‰ 65+ ä¸ªç¾¤ç»„/é¢‘é“
- éœ€è¦æ‰€æœ‰ç¾¤ä¸»/ç®¡ç†å‘˜é…åˆ
- Bot éœ€è¦è¯»å–æˆå‘˜æƒé™
- **ç§æœ‰é‚€è¯·é“¾æ¥æ— æ³•é€šè¿‡ API è‡ªåŠ¨åŠ å…¥**

**ç»“è®º**: å¯¹äºä½¿ç”¨ç§æœ‰é‚€è¯·é“¾æ¥çš„èµ„æºï¼Œæ­¤æ–¹æ¡ˆ**ä¸å®ç”¨**

---

### æ–¹æ¡ˆ C: åŠè‡ªåŠ¨åŒ–ï¼ˆæ¨èå®é™…ä½¿ç”¨ï¼‰

#### ğŸ“ å®ç°æ–¹å¼

**å·¥å…·**: Python + Telethon (ä¸ªäººè´¦å·) + æ‰‹åŠ¨ç‚¹å‡»é“¾æ¥

```python
#!/usr/bin/env python3
"""
åŠè‡ªåŠ¨åŒ–è·å– Telegram æ•°æ®
é€‚ç”¨äºç§æœ‰é‚€è¯·é“¾æ¥çš„åœºæ™¯
"""
import json
import asyncio
from telethon import TelegramClient
from telethon.tl.functions.channels import GetFullChannelRequest
from telethon.tl.functions.messages import GetFullChatRequest

# ä½¿ç”¨ä¸ªäººè´¦å·çš„å‡­è¯
API_ID = 12345678  # ä» my.telegram.org è·å–
API_HASH = 'your_api_hash'
PHONE = '+86 138 0000 0000'  # ä½ çš„æ‰‹æœºå·

async def get_stats_from_joined_chats():
    """ä»å·²åŠ å…¥çš„ç¾¤ç»„/é¢‘é“è·å–æ•°æ®"""
    
    # åˆ›å»ºå®¢æˆ·ç«¯ï¼ˆä½¿ç”¨ä¸ªäººè´¦å·ï¼‰
    client = TelegramClient('my_account', API_ID, API_HASH)
    await client.start(phone=PHONE)
    
    # è¯»å–ç°æœ‰æ•°æ®
    with open('resources.json', 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    # è·å–æ‰€æœ‰å·²åŠ å…¥çš„å¯¹è¯
    dialogs = await client.get_dialogs()
    dialog_dict = {}
    
    # å»ºç«‹é“¾æ¥åˆ°å¯¹è¯çš„æ˜ å°„
    for dialog in dialogs:
        entity = dialog.entity
        # ä¿å­˜å®ä½“ä¿¡æ¯
        if hasattr(entity, 'username') and entity.username:
            dialog_dict[entity.username.lower()] = entity
        if hasattr(entity, 'id'):
            dialog_dict[str(entity.id)] = entity
    
    print(f"ğŸ“Š å·²åŠ å…¥ {len(dialogs)} ä¸ªå¯¹è¯")
    print(f"ğŸ” å¼€å§‹åŒ¹é…èµ„æº...\n")
    
    updated = 0
    not_found = []
    
    # éå†æ‰€æœ‰èµ„æº
    for category in data['categories']:
        resources = []
        
        if category.get('hasSubcategories'):
            for subcategory in category['subcategories']:
                resources.extend(subcategory['resources'])
        else:
            resources = category.get('resources', [])
        
        for resource in resources:
            if 'link' not in resource:
                continue
            
            link = resource['link']
            title = resource['title']
            
            try:
                # å°è¯•ä»é“¾æ¥è§£æå®ä½“
                entity = None
                
                # æ–¹æ³•1: é€šè¿‡ç”¨æˆ·å
                if 't.me/' in link and '/+' not in link:
                    username = link.split('/')[-1].lower()
                    entity = dialog_dict.get(username)
                
                # æ–¹æ³•2: æ‰‹åŠ¨è¾“å…¥ç¾¤ç»„IDï¼ˆéœ€è¦æå‰è®°å½•ï¼‰
                # ä½ å¯ä»¥å…ˆè¿è¡Œä¸€æ¬¡ï¼Œæ‰“å°æ‰€æœ‰å·²åŠ å…¥ç¾¤ç»„çš„IDå’Œæ ‡é¢˜
                
                if entity:
                    # è·å–æˆå‘˜æ•°
                    try:
                        if hasattr(entity, 'megagroup') or hasattr(entity, 'broadcast'):
                            # é¢‘é“æˆ–è¶…çº§ç¾¤ç»„
                            full = await client(GetFullChannelRequest(channel=entity))
                            count = full.full_chat.participants_count
                            
                            if 'subscribers' in resource:
                                resource['subscribers'] = count
                                print(f"âœ… ğŸ“¢ {title}: {count} è®¢é˜…è€…")
                            elif 'memberCount' in resource:
                                resource['memberCount'] = count
                                print(f"âœ… ğŸ‘¥ {title}: {count} æˆå‘˜")
                            updated += 1
                        else:
                            # æ™®é€šç¾¤ç»„
                            full = await client(GetFullChatRequest(chat_id=entity.id))
                            count = full.full_chat.participants_count
                            resource['memberCount'] = count
                            print(f"âœ… ğŸ‘¥ {title}: {count} æˆå‘˜")
                            updated += 1
                    
                    except Exception as e:
                        print(f"âŒ {title}: è·å–æ•°æ®å¤±è´¥ - {e}")
                        not_found.append(title)
                else:
                    print(f"âš ï¸  {title}: æœªåŠ å…¥æ­¤ç¾¤ç»„/é¢‘é“")
                    not_found.append(title)
                
                # é¿å…é€Ÿç‡é™åˆ¶
                await asyncio.sleep(1)
                
            except Exception as e:
                print(f"âŒ {title}: é”™è¯¯ - {e}")
                not_found.append(title)
    
    # æ›´æ–°æ—¶é—´æˆ³
    from datetime import date
    data['updateTime'] = date.today().strftime('%Y-%m-%d')
    
    # ä¿å­˜æ•°æ®
    with open('resources.json', 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
    
    print(f"\nğŸ“ˆ ç»Ÿè®¡:")
    print(f"  âœ… æˆåŠŸæ›´æ–°: {updated} ä¸ª")
    print(f"  âŒ æœªæ‰¾åˆ°: {len(not_found)} ä¸ª")
    
    if not_found:
        print(f"\nâš ï¸  æœªæ›´æ–°çš„èµ„æº:")
        for title in not_found[:10]:  # åªæ˜¾ç¤ºå‰10ä¸ª
            print(f"  - {title}")
    
    await client.disconnect()

async def list_all_joined_chats():
    """åˆ—å‡ºæ‰€æœ‰å·²åŠ å…¥çš„ç¾¤ç»„/é¢‘é“ï¼ˆè¾…åŠ©å·¥å…·ï¼‰"""
    client = TelegramClient('my_account', API_ID, API_HASH)
    await client.start(phone=PHONE)
    
    dialogs = await client.get_dialogs()
    
    print("ğŸ“‹ æ‰€æœ‰å·²åŠ å…¥çš„ç¾¤ç»„/é¢‘é“:\n")
    print(f"{'ID':<15} {'æ ‡é¢˜':<30} {'ç±»å‹':<10} {'æˆå‘˜æ•°':<10}")
    print("-" * 70)
    
    for dialog in dialogs:
        entity = dialog.entity
        title = getattr(entity, 'title', getattr(entity, 'first_name', 'Unknown'))
        entity_id = entity.id
        
        # è·å–æˆå‘˜æ•°
        try:
            if hasattr(entity, 'megagroup') or hasattr(entity, 'broadcast'):
                full = await client(GetFullChannelRequest(channel=entity))
                count = full.full_chat.participants_count
                entity_type = "é¢‘é“" if getattr(entity, 'broadcast', False) else "è¶…çº§ç¾¤ç»„"
            else:
                full = await client(GetFullChatRequest(chat_id=entity.id))
                count = full.full_chat.participants_count
                entity_type = "ç¾¤ç»„"
            
            print(f"{entity_id:<15} {title[:28]:<30} {entity_type:<10} {count:<10}")
        except:
            pass
    
    await client.disconnect()

if __name__ == '__main__':
    import sys
    
    if len(sys.argv) > 1 and sys.argv[1] == 'list':
        # python fetch_stats.py list - åˆ—å‡ºæ‰€æœ‰å·²åŠ å…¥çš„ç¾¤ç»„
        asyncio.run(list_all_joined_chats())
    else:
        # python fetch_stats.py - æ›´æ–°æ•°æ®
        asyncio.run(get_stats_from_joined_chats())
```

#### ğŸ“ ä½¿ç”¨æ­¥éª¤

1. **æ‰‹åŠ¨åŠ å…¥æ‰€æœ‰ç¾¤ç»„/é¢‘é“**
   ```
   # ç”¨ä½ çš„ä¸ªäººè´¦å·ç‚¹å‡»æ‰€æœ‰ 65+ ä¸ªé‚€è¯·é“¾æ¥
   # è¿™æ˜¯ä¸€æ¬¡æ€§å·¥ä½œï¼ŒåŠ å…¥åå°±ä¸ç”¨å†ç®¡
   ```

2. **é¦–æ¬¡è¿è¡Œï¼šåˆ—å‡ºæ‰€æœ‰ç¾¤ç»„**
   ```bash
   python scripts/fetch_stats.py list
   ```

3. **æ›´æ–°æ•°æ®**
   ```bash
   python scripts/fetch_stats.py
   ```

4. **æäº¤åˆ° GitHub**
   ```bash
   git add resources.json
   git commit -m "æ›´æ–° Telegram ç»Ÿè®¡æ•°æ®"
   git push
   ```

#### â° å®šæ—¶ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰

åœ¨æœ¬åœ°è®¾ç½® cron æˆ–ä½¿ç”¨ GitHub Actions æ‰‹åŠ¨è§¦å‘ï¼š

```yaml
# .github/workflows/manual-update-stats.yml
name: Manual Update Telegram Stats

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install dependencies
        run: pip install telethon
      - name: Update stats
        env:
          API_ID: ${{ secrets.API_ID }}
          API_HASH: ${{ secrets.API_HASH }}
          PHONE: ${{ secrets.PHONE }}
          # éœ€è¦sessionæ–‡ä»¶ï¼Œé¦–æ¬¡è¿è¡Œéœ€è¦éªŒè¯ç 
        run: python scripts/fetch_stats.py
      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add resources.json
          git commit -m "Update stats" || exit 0
          git push
```

---

### æ–¹æ¡ˆ D: å®Œå…¨æ‰‹åŠ¨ï¼ˆæœ€ç®€å•æœ€å¯é ï¼‰

#### ï¿½ å»ºè®®æµç¨‹

æ¯å‘¨æˆ–æ¯æœˆæ‰‹åŠ¨æ›´æ–°ä¸€æ¬¡ï¼š

1. **æ‰“å¼€ Telegram**
2. **ä¾æ¬¡è®¿é—®æ¯ä¸ªç¾¤ç»„/é¢‘é“**
3. **æŸ¥çœ‹æˆå‘˜æ•°**
4. **æ‰‹åŠ¨æ›´æ–° `resources.json`**

**ä¼˜ç‚¹:**
- âœ… 100% å‡†ç¡®
- âœ… æ— éœ€å¤æ‚é…ç½®
- âœ… å¯ä»¥åŒæ—¶æ›´æ–°åœ¨çº¿äººæ•°ï¼ˆç›®æµ‹ä¼°ç®—ï¼‰
- âœ… æ²¡æœ‰ API é™åˆ¶

**ç¼ºç‚¹:**
- âŒ è€—æ—¶ï¼ˆçº¦ 30-60 åˆ†é’Ÿï¼‰
- âŒ å®¹æ˜“é—æ¼
- âŒ éœ€è¦å®šæœŸæ‰§è¡Œ

---

## ğŸ¯ é’ˆå¯¹æ‚¨çš„æƒ…å†µçš„æœ€ä½³æ–¹æ¡ˆ

### æ¨è: æ–¹æ¡ˆ C (åŠè‡ªåŠ¨åŒ–) + æ–¹æ¡ˆ D (æ‰‹åŠ¨è¡¥å……)

**å…·ä½“å®æ–½:**

1. **ä¸€æ¬¡æ€§å‡†å¤‡** (30åˆ†é’Ÿ)
   - ç”¨ä½ çš„ä¸ªäºº Telegram è´¦å·ç‚¹å‡»æ‰€æœ‰ 65+ ä¸ªé‚€è¯·é“¾æ¥åŠ å…¥
   - è·å– API å‡­è¯ï¼ˆmy.telegram.orgï¼‰
   - é…ç½® Python è„šæœ¬

2. **æ¯å‘¨/æ¯æœˆæ‰§è¡Œ** (5åˆ†é’Ÿ)
   - è¿è¡Œè„šæœ¬è‡ªåŠ¨æ›´æ–° `memberCount` å’Œ `subscribers`
   - æ‰‹åŠ¨ä¼°ç®—å¹¶æ›´æ–° `onlineCount`ï¼ˆå¯é€‰ï¼‰
   - æäº¤åˆ° GitHub

3. **ä¼˜åŠ¿å¯¹æ¯”**
   | æ–¹æ¡ˆ | è‡ªåŠ¨åŒ–ç¨‹åº¦ | å‡†ç¡®æ€§ | å®æ–½éš¾åº¦ | ç»´æŠ¤æˆæœ¬ |
   |------|-----------|--------|----------|----------|
   | Bot API | â­â­â­â­â­ | â­â­â­â­ | âŒ é«˜ï¼ˆéœ€è¦BotåŠ å…¥æ‰€æœ‰ç¾¤ï¼‰ | â­â­â­ |
   | åŠè‡ªåŠ¨(æ¨è) | â­â­â­â­ | â­â­â­â­â­ | âœ… ä¸­ï¼ˆä¸€æ¬¡æ€§åŠ å…¥ç¾¤ç»„ï¼‰ | â­â­â­â­ |
   | å®Œå…¨æ‰‹åŠ¨ | â­ | â­â­â­â­â­ | âœ… ä½ | â­â­ |

---

## âš ï¸ é‡è¦é™åˆ¶ï¼ˆæ— æ³•è§£å†³çš„é—®é¢˜ï¼‰

### 1. **åœ¨çº¿äººæ•°æ— æ³•è‡ªåŠ¨è·å–**
```
âŒ Telegram API ä¸æä¾›
âŒ Telegram Web ä¸æ˜¾ç¤º
âŒ ä»»ä½•æ–¹æ¡ˆéƒ½æ— æ³•è‡ªåŠ¨è·å–
```

**è§£å†³æ–¹æ¡ˆ:**
- æ‰‹åŠ¨è®¿é—®ç¾¤ç»„æŸ¥çœ‹ï¼ˆéœ€è¦æ˜¯æˆå‘˜ï¼‰
- æŒ‰æ¯”ä¾‹ä¼°ç®—ï¼ˆå¦‚ memberCount * 0.1ï¼‰
- ä¿æŒå›ºå®šå€¼ï¼Œä»…æ›´æ–°æ€»äººæ•°

### 2. **ç§æœ‰é‚€è¯·é“¾æ¥çš„é™åˆ¶**
```
âŒ Bot æ— æ³•è‡ªåŠ¨é€šè¿‡ t.me/+ é“¾æ¥åŠ å…¥
âŒ éœ€è¦ç®¡ç†å‘˜æ‰‹åŠ¨é‚€è¯· Bot
âŒ æˆ–ä½¿ç”¨ä¸ªäººè´¦å·ï¼ˆéœ€è¦ç‚¹å‡»é“¾æ¥åŠ å…¥ï¼‰
```

### 3. **API é€Ÿç‡é™åˆ¶**
```
âš ï¸  æ¯ç§’æœ€å¤š 30 æ¬¡è¯·æ±‚
âš ï¸  æ¯åˆ†é’Ÿæœ€å¤š 20 æ¬¡ getChat è¯·æ±‚
âš ï¸  éœ€è¦æ·»åŠ å»¶è¿Ÿé¿å…å°ç¦
```

---

## ğŸ“‹ å®æ–½å»ºè®®

### å¯¹äºæ‚¨çš„é¡¹ç›®ï¼Œæˆ‘å»ºè®®:

âœ… **çŸ­æœŸæ–¹æ¡ˆ** (ç«‹å³å¯ç”¨)
1. ä¿æŒå½“å‰æ‰‹åŠ¨æ›´æ–°çš„æ•°æ®ç»“æ„
2. æ¯æœˆæ‰‹åŠ¨æ›´æ–°ä¸€æ¬¡ä¸»è¦æ•°æ®
3. trending å­—æ®µæ‰‹åŠ¨æ ‡è®°

âœ… **ä¸­æœŸæ–¹æ¡ˆ** (1-2å‘¨å®æ–½)
1. ç”¨ä¸ªäººè´¦å·åŠ å…¥æ‰€æœ‰ç¾¤ç»„/é¢‘é“ï¼ˆä¸€æ¬¡æ€§ï¼‰
2. é…ç½®åŠè‡ªåŠ¨åŒ–è„šæœ¬
3. æ¯å‘¨è¿è¡Œä¸€æ¬¡è‡ªåŠ¨æ›´æ–°

âœ… **é•¿æœŸæ–¹æ¡ˆ** (æœªæ¥ä¼˜åŒ–)
1. è€ƒè™‘ä½¿ç”¨ GitHub Actions å®šæ—¶è§¦å‘
2. å»ºç«‹æ•°æ®å†å²è®°å½•
3. æ·»åŠ æ•°æ®å¯è§†åŒ–ï¼ˆå¢é•¿è¶‹åŠ¿å›¾ï¼‰

---

## ğŸ”§ éœ€è¦æˆ‘å¸®æ‚¨åˆ›å»ºä»€ä¹ˆï¼Ÿ

æˆ‘å¯ä»¥ä¸ºæ‚¨å‡†å¤‡:

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Telegram Bot API](https://core.telegram.org/bots/api)
- [Telethon æ–‡æ¡£](https://docs.telethon.dev/)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [Telegram API é™åˆ¶](https://core.telegram.org/api/obtaining_api_id)

---

**åˆ›å»ºæ—¥æœŸ**: 2025-11-18  
**ç»´æŠ¤è€…**: CJSS-Tech  
**ä»“åº“**: github.com/CJSS-Tech/hwtg
